name: PR Base Branch Check

on:
  pull_request_target:
    types: [opened]
    branches: [main]

jobs:
  warn-wrong-base:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: Warn about incorrect base branch
        uses: actions/github-script@v7
        with:
          script: |
            const message = `## ⚠️ Wrong base branch

            This PR targets \`main\`, but PRs should target the \`netlify\` branch.

            - **\`netlify\`** — deploy branch with full site (Netlify builds from here)
            - **\`main\`** — barebones version for forks (not for PRs)

            Please change the base branch:
            1. Click **Edit** next to the PR title
            2. Change base branch from \`main\` to \`netlify\`

            Or close this PR and create a new one targeting \`netlify\`.`;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              body: message
            });

            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              labels: ['wrong-base-branch']
            });
